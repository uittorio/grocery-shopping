#!/usr/bin/env bash
set -euo pipefail

if ! command -v gitleaks &>/dev/null; then
  echo "gitleaks not found. Install it: brew install gitleaks"
  exit 1
fi

echo "Running gitleaks on staged changes..."

if ! gitleaks protect --staged --verbose; then
  echo ""
  echo "Commit blocked: gitleaks found potential secrets in staged changes."
  echo ""
  echo "To fix:"
  echo "  1. Remove the secret from the file"
  echo "  2. If it's a false positive, add an allowlist entry in .gitleaks.toml"
  echo "  3. Never use 'git commit --no-verify' to skip this check"
  exit 1
fi
